<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SMOU Group – Company Profile 2026</title>

  <style>
    :root{--brand:#0b3c6d;}
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--brand);color:#fff;height:100vh;display:flex;flex-direction:column;}
    header{background:#0a345f;padding:14px 12px;text-align:center;font-weight:700}
    .toolbar{
      display:flex;gap:8px;justify-content:center;align-items:center;
      padding:10px;background:#093055;flex-wrap:wrap
    }
    .btn{
      cursor:pointer;border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.08);color:#fff;
      padding:8px 12px;border-radius:10px;font-weight:600
    }
    .btn:hover{background:rgba(255,255,255,.14)}
    .status{font-size:13px;opacity:.9;margin-left:6px}

    #stage{flex:1;display:flex;justify-content:center;align-items:center;padding:12px;overflow:hidden;}
    #viewer{
      width:min(1200px,95vw);
      height:calc(100vh - 140px);
      background:rgba(255,255,255,.08);
      border-radius:14px;
      box-shadow:0 20px 50px rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
    }
    #flipbook{
      position:absolute;left:50%;top:50%;
      transform:translate(-50%,-50%) scale(1);
      transform-origin:center center;
    }
    #flipbook .page{
      background:#fff;
      display:flex;justify-content:center;align-items:center;
    }
    canvas{display:block;}
  </style>

  <!-- Load order: jQuery ثم turn.js ثم pdf.js -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>

<body>
  <header>SMOU Group – Company Profile 2026</header>

  <div class="toolbar">
    <button class="btn" id="prev">◀ Prev</button>
    <button class="btn" id="next">Next ▶</button>
    <button class="btn" id="zoomOut">－</button>
    <button class="btn" id="zoomIn">＋</button>
    <button class="btn" id="fit">Fit</button>
    <button class="btn" id="fs">Fullscreen</button>
    <span class="status" id="status">Loading…</span>
  </div>

  <div id="stage">
    <div id="viewer">
      <div id="flipbook"></div>
    </div>
  </div>

<script>
  const PDF_URL = "profile-smou-group-2026.pdf";

  // PDF worker
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

  const statusEl = document.getElementById("status");
  const flipbookEl = document.getElementById("flipbook");
  const viewerEl = document.getElementById("viewer");

  let zoom = 1;

  function setStatus(t){ statusEl.textContent = t; }

  function setZoom(z){
    zoom = Math.max(0.6, Math.min(2.2, z));
    flipbookEl.style.transform = `translate(-50%,-50%) scale(${zoom})`;
  }

  function fitToScreen(){
    // نعمل Fit على أساس عرض الـ viewer
    const vw = viewerEl.clientWidth;
    const vb = viewerEl.clientHeight;

    const bookW = $("#flipbook").turn("size").width;
    const bookH = $("#flipbook").turn("size").height;

    const scaleW = (vw - 30) / bookW;
    const scaleH = (vb - 30) / bookH;

    setZoom(Math.min(scaleW, scaleH));
  }

  async function buildFlipbook(){
    try{
      setStatus("Loading PDF…");
      const pdf = await pdfjsLib.getDocument(PDF_URL).promise;

      setStatus(`Rendering ${pdf.numPages} pages…`);

      // Render pages sequentially
      for(let pageNum=1; pageNum<=pdf.numPages; pageNum++){
        const page = await pdf.getPage(pageNum);

        // scale للوضوح (لو الملف كبير قللها 1.2)
        const viewport = page.getViewport({ scale: 1.4 });

        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = Math.floor(viewport.width);
        canvas.height = Math.floor(viewport.height);

        await page.render({ canvasContext: ctx, viewport }).promise;

        const pageDiv = document.createElement("div");
        pageDiv.className = "page";
        pageDiv.appendChild(canvas);
        flipbookEl.appendChild(pageDiv);
      }

      // Init turn.js بعد إضافة كل الصفحات
      // عرض صفحتين جنب بعض (magazine)
      const pageW = flipbookEl.querySelector("canvas").width;
      const pageH = flipbookEl.querySelector("canvas").height;

      $("#flipbook").turn({
        width: pageW * 2,
        height: pageH,
        autoCenter: true,
        display: "double",   // ✅ مجلة (صفحتين)
        gradients: true,
        elevation: 50
      });

      setStatus("Ready ✅");

      // Fit افتراضي
      fitToScreen();

      // resize
      window.addEventListener("resize", () => {
        // لا نغير size هنا حتى لا يهنج، فقط fit
        fitToScreen();
      });

    }catch(err){
      console.error(err);
      setStatus("Error: PDF not found or blocked");
      // افتح رابط pdf مباشرة للتأكد:
      // https://catalog.smougroup.com/profile-smou-group-2026.pdf
    }
  }

  // Controls
  document.getElementById("prev").onclick = () => $("#flipbook").turn("previous");
  document.getElementById("next").onclick = () => $("#flipbook").turn("next");

  document.getElementById("zoomIn").onclick = () => setZoom(zoom + 0.1);
  document.getElementById("zoomOut").onclick = () => setZoom(zoom - 0.1);
  document.getElementById("fit").onclick = () => fitToScreen();

  document.getElementById("fs").onclick = async () => {
    if (!document.fullscreenElement) {
      await viewerEl.requestFullscreen();
      setTimeout(fitToScreen, 300);
    } else {
      await document.exitFullscreen();
      setTimeout(fitToScreen, 300);
    }
  };

  // Keyboard arrows
  document.addEventListener("keydown", (e) => {
    if(e.key === "ArrowLeft") $("#flipbook").turn("previous");
    if(e.key === "ArrowRight") $("#flipbook").turn("next");
    if(e.key === "+") setZoom(zoom + 0.1);
    if(e.key === "-") setZoom(zoom - 0.1);
  });

  buildFlipbook();
</script>

</body>
</html>
